## Общее описание работы бота для нанимающих менеджеров (НМ)

### Онбординг НМ

НМ заходит в бот и нажимает кнопку `/start`.
Мы создаем нового пользователя НМ у себя в коре (такой пользователь уже может быть).
Бот отвечает:
“Привет, <Имя>! Здесь ты можешь создать заявку на подбор стажера и найти его! Только создай заявку!”


### Создание вакансии (заявки на стажера)

НМ нажимает кнопку `/create_vacancy`.

1. Бот делает запрос на бек:
   `GET /tracks` — по ним будем генерить клавиатуру выбора трэка.

2. После выбора трека НМ → дергаем:
   `POST /vacancy` — создаем позицию в базе данных. По данным сохраняем:

* `PK vacancy_id`
* `FK manager_id`
* `track_id` (или FK, или айтем из списка)
* `status = 'draft'`

3. После заполнения описания вакансии НМ → дергаем:
   `PUT /vacancy` — обновляем описание позиции. По данным сохраняем:

* `description`

4. После нажатия `/confirm` НМ → дергаем:
   `PUT /vacancy` — обновляем статус позиции. По данным сохраняем:

* `status = 'active'`

5. Если позиция не подтвердилась и НМ нажал `/abort` → дергаем:
   `PUT /vacancy` — обновляем статус позиции. По данным сохраняем:

* `status = 'aborted'`



###  Меню и базовая навигация

НМ в любой момент может нажать `/menu` (или кнопку “Меню”).
Бот показывает основные действия:

* `/create_vacancy` — создать заявку
* `/vacancies` — мои открытые вакансии
* `/set_slots` — настроить слоты календаря


### Просмотр списка вакансий НМ

НМ нажимает кнопку `/vacancies`.

Бот делает запрос в кор на список его открытых активных вакансий:
`GET /vacancy` (фильтр по manager_id + status=active).

Если список пуст — бот должен вернуть сообщение:
“Сори, увы, анлак. Создай сначала позицию и потом увидишь список.”

Кор в данном сетапе лишь отдает список открытых позиций (с айдишниками, статусами и описаниями), бот — правильно собирает и отправляет сообщение человеку.
Также бот может дергать этот эндпоинт как “статус” — чтоб правильно формировать клавиатуру для пользователя.


### Карточка вакансии (просмотр и управление)

После того, как бот отобразил список открытых вакансий (кнопками), НМ нажимая на одну из кнопок проваливается в описание вакансии, дернув:
`GET /vacancy/{vacancy_id}`

**Что НМ увидит в карточке вакансии:**

* Трэк
* Описание позиции
* Статус
* Дата создания
* Количество: просмотренных / отобранных / отсобеседованных / финалистов
* Дата ближайшего собеседования
* Ссылка на собес (если создана/назначена)

**Кнопки в карточке вакансии (управление):**

* `/pick_candidate` — подобрать кандидата (тиндер-режим)
* `/candidates_interview` — назначенные интервью
* `/candidates_shortlist` — замороженные после интервью
* `/candidates_finalists` — финалисты
* `/candidates_offer` — оффер выдан
* `/update_vacancy` - для обновления описания / постановки на паузу / отключения 
* `/back`


### Настройка слотов (availability) для собеседований

НМ нажимает `/set_slots` из меню .

1. Бот получает ссылку на страницу настройки слотов от core (демо-логика):
   `POST /manager/me/magic_schedule_link` → core возвращает `availability_url` вида
   `https://our-domain/hm/availability/<token>`

2. Бот отправляет НМ сообщение:
   “Открой ссылку и выставь удобные окна для собеседований” + кнопка “Открыть”.

3. НМ редиректится на страницу и выставляет доступность.
   После сохранения страница пишет availability в core/бек (по токену).

###  Подбор и ревью кандидатов (как “тиндер”)

НМ открывает вакансию и нажимает `/pick_candidate`.

1. Бот дергает:
   `POST /vacancy/{vacancy_id}/candidates:next` — core находит лучший мэтч и возвращает 1 кандидата.

2. Бот показывает карточку кандидата:

* анкета (вуз/курс/достижения/домены)
* quiz score по треку
* короткое summary

3. НМ принимает решение кнопками:

* `/invite` — позвать на собес
* `/skip` — следующий кандидат
* `/redirect` — может подойти другой команде
* `/reject` — отказ
* `/back` - при нажатии этой кнопки мы считаем, что рекрутер не дал фидбека по челиксу и этот же кандидат может быть показан в счастливом будущем

4. Бот сохраняет решение:
   `POST /vacancy/{vacancy_id}/candidates/{candidate_id}/decision`
   payload: `decision = invite|skip|redirect|reject`

Если НМ нажал `/invite`, запускается флоу назначения собеседования (см. ниже).

При нажатии любой кнопки - меняется статус решения НМ по данному кандидату


### Назначение собеседования кандидату (запись на слоты)

Когда НМ решил позвать кандидата на интервью (`/invite`):

* Core переводит кандидата в статус “invited / interview pending”
* Candidate Bot отправляет кандидату отбивку:
  “Тобой заинтересовалась команда <X> по позиции <Y>. Хочешь пройти собеседование?”

Если кандидат нажимает “Да”:

* кандидат получает выбор свободных слотов (которые выставил НМ)
* выбирает удобное окно → создается интервью (booking)

Если подходящего времени нет:

* кандидат нажимает “нет подходящего времени”
* в core создается задача рекрутеру (exception), чтобы подключился человек

---

### Отдача фидбека после собеседования

После завершения интервью core автоматически отправляет НМ сообщение в бот:
“Как прошло собеседование с кандидатом <…>?”

НМ должен дать комментарий + выбрать, что делаем с кандидатом:

* отказ вообще челу во всей компании
* отказ по данной команде, но другие НМ еще могут его смотреть
* вроде ниче чел, но пока хз — поморозим и посмотрим еще
* в список финалистов

Решение и комментарий сохраняются в core (feedback + decision).
Дальше статусы/уведомления кандидату уходят автоматически.


###  Отмена / перенос собеседования

НМ открывает вакансию → список интервью/назначенных кандидатов → выбирает конкретное интервью.

**Кнопки:**

* `/cancel_interview` — отменить
* `/reschedule` — перенести

Отмена:

* подтверждение в боте
* core меняет статус интервью на cancelled
* кандидат получает уведомление

Перенос:

* НМ либо обновляет availability (`/set_slots`), либо сразу инициирует “перебронь”
* кандидату уходит ссылка/выбор новых слотов
* если кандидат не находит слот → создается recruiter task
